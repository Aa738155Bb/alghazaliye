{% extends "layout.html" %}

{% block title %}سندات الصرف{% endblock %}

{% block content %}
<!-- Content Header (Page header) -->
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0">سندات الصرف</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-left">
                    <li class="breadcrumb-item"><a href="/dashboard">الرئيسية</a></li>
                    <li class="breadcrumb-item active">سندات الصرف</li>
                </ol>
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>
<!-- /.content-header -->

<!-- Main content -->
<section class="content">
    <div class="container-fluid">
        <!-- نظرة عامة -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-money-bill-wave ml-2"></i>
                            قائمة سندات الصرف
                        </h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#modal-add-payment-voucher">
                                <i class="fas fa-plus"></i> سند صرف جديد
                            </button>
                            <a href="/receipt-vouchers" class="btn btn-primary ml-2">
                                <i class="fas fa-file-invoice"></i> سندات القبض
                            </a>
                        </div>
                    </div>
                    <!-- /.card-header -->
                    <div class="card-body table-responsive p-0">
                        <table class="table table-hover text-nowrap datatable">
                            <thead>
                                <tr>
                                    <th>رقم السند</th>
                                    <th>نوع السند</th>
                                    <th>المستفيد</th>
                                    <th>المبلغ</th>
                                    <th>تاريخ العملية</th>
                                    <th>وصف العملية</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- بيانات توضيحية -->
                                <tr>
                                    <td>123456</td>
                                    <td><span class="badge badge-danger">سند صرف</span></td>
                                    <td>شركة الخطوط السعودية (مورد)</td>
                                    <td>1000 ريال</td>
                                    <td>2023-06-15</td>
                                    <td>دفعة مقدمة لحجز تذاكر</td>
                                    <td>
                                        <button class="btn btn-info btn-sm">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-primary btn-sm">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-danger btn-sm">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>123458</td>
                                    <td><span class="badge badge-danger">سند صرف</span></td>
                                    <td>محمد عبدالله (موظف)</td>
                                    <td>1200 ريال</td>
                                    <td>2023-06-17</td>
                                    <td>مصاريف نثرية</td>
                                    <td>
                                        <button class="btn btn-info btn-sm">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-primary btn-sm">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-danger btn-sm">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- /.card-body -->
                </div>
                <!-- /.card -->
            </div>
        </div>
        <!-- /.row -->
    </div>
    <!-- /.container-fluid -->
</section>
<!-- /.content -->

<!-- Modal - إضافة سند صرف جديد -->
<div class="modal fade" id="modal-add-payment-voucher">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success">
                <h4 class="modal-title">
                    إضافة سند صرف جديد
                    <span id="voucher-number-display" class="badge badge-light ml-2">رقم السند: <span id="voucher-number-value">تلقائي</span></span>
                </h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form id="payment-voucher-form">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="alert alert-info alert-dismissible">
                                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                                <h5><i class="icon fas fa-info"></i> معلومات عن سند الصرف!</h5>
                                <p>يستخدم سند الصرف عند دفع مبلغ من المكتب لمستفيد (مورد، موظف، عميل، صندوق أو بنك).</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- الحساب المصدر (الحساب الأول) -->
                    <div class="card card-outline card-primary mb-3">
                        <div class="card-header">
                            <h3 class="card-title">الحساب المصدر</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="account-type">نوع الحساب <span class="text-danger">*</span></label>
                                        <select class="form-control" id="account-type" name="account-type" required>
                                            <option value="">اختر نوع الحساب</option>
                                            <option value="bank">بنك</option>
                                            <option value="cashbox">صندوق</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="account-name">الحساب <span class="text-danger">*</span></label>
                                        <select class="form-control" id="account-name" name="account-name" required disabled>
                                            <option value="">يرجى اختيار نوع الحساب أولاً</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- الحساب المستفيد (الحساب الآخر) -->
                    <div class="card card-outline card-success mb-3">
                        <div class="card-header">
                            <h3 class="card-title">الحساب المستفيد</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="other-account-type">نوع الحساب الآخر <span class="text-danger">*</span></label>
                                        <select class="form-control" id="other-account-type" name="other-account-type" required>
                                            <option value="">اختر نوع الحساب</option>
                                            <option value="supplier">مورد</option>
                                            <option value="employee">موظف</option>
                                            <option value="customer">عميل</option>
                                            <option value="bank">بنك</option>
                                            <option value="cashbox">صندوق</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="other-account-name">الحساب الآخر <span class="text-danger">*</span></label>
                                        <select class="form-control" id="other-account-name" name="other-account-name" required disabled>
                                            <option value="">يرجى اختيار نوع الحساب الآخر أولاً</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- بيانات المعاملة -->
                    <div class="card card-outline card-info mb-3">
                        <div class="card-header">
                            <h3 class="card-title">بيانات المعاملة</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="currency-type">نوع العملة <span class="text-danger">*</span></label>
                                        <select class="form-control" id="currency-type" name="currency-type" required>
                                            <option value="SAR" selected>ريال سعودي (SAR)</option>
                                            <option value="USD">دولار أمريكي (USD)</option>
                                            <option value="EUR">يورو (EUR)</option>
                                            <option value="GBP">جنيه إسترليني (GBP)</option>
                                            <option value="AED">درهم إماراتي (AED)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="amount">المبلغ <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <input type="number" min="0" step="0.01" class="form-control" id="amount" name="amount" placeholder="أدخل المبلغ" required>
                                            <div class="input-group-append">
                                                <span class="input-group-text" id="currency-symbol">ر.س</span>
                                            </div>
                                        </div>
                                        <small class="text-muted" id="amount-in-words"></small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="reference-type">نوع المرجع</label>
                                        <input type="text" class="form-control" id="reference-type" name="reference-type" placeholder="أدخل نوع المرجع (مثلاً: فاتورة شراء، مصروف تشغيلي)">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="reference-number">رقم المرجع</label>
                                        <input type="text" class="form-control" id="reference-number" name="reference-number" placeholder="أدخل رقم المستند المرجعي">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="operation-date">تاريخ العملية <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                            </div>
                                            <input type="date" class="form-control" id="operation-date" name="operation-date" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="voucher-number">رقم السند</label>
                                        <input type="text" class="form-control" id="voucher-number" name="voucher-number" placeholder="سيتم إنشاؤه تلقائياً" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- البيان والملاحظات -->
                    <div class="card card-outline card-secondary mb-3">
                        <div class="card-header">
                            <h3 class="card-title">البيان والملاحظات</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label for="description">البيان (وصف العملية) <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="description" name="description" rows="3" required readonly></textarea>
                                <small class="text-info">يتم إنشاء البيان تلقائياً بناءً على البيانات المدخلة، يمكنك تعديله عند الحاجة.</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="notes">ملاحظات إضافية</label>
                                <textarea class="form-control" id="notes" name="notes" rows="2" placeholder="أدخل أي ملاحظات إضافية"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-default" data-dismiss="modal">إلغاء</button>
                    <button type="submit" class="btn btn-success">حفظ السند</button>
                </div>
            </form>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->

{% endblock %}

{% block scripts %}
<script>
    // تهيئة النماذج عند تحميل الصفحة
    document.addEventListener('DOMContentLoaded', function() {
        // تهيئة رقم السند عند فتح النموذج
        $('#modal-add-payment-voucher').on('show.bs.modal', function (e) {
            // توليد رقم سند افتراضي (في النظام الحقيقي سيتم جلبه من الخادم)
            const randomVoucherNumber = 'PAY-' + new Date().getFullYear() + '-' + Math.floor(1000 + Math.random() * 9000);
            document.getElementById('voucher-number').value = randomVoucherNumber;
            document.getElementById('voucher-number-value').textContent = randomVoucherNumber;
        });
        
        // تسجيل مستمعي الأحداث لتحديث البيان تلقائياً
        const statementFields = [
            'account-type', 'account-name', 'other-account-type', 
            'other-account-name', 'reference-type', 'reference-number'
        ];
        
        statementFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('change', updateVoucherStatement);
                // بالنسبة للحقول النصية مثل نوع المرجع، نحتاج أيضًا إلى مراقبة حدث input
                if (field.type === 'text' || field.type === 'textarea') {
                    field.addEventListener('input', updateVoucherStatement);
                }
            }
        });
        
        // تعامل مع تغيير نوع الحساب
        document.getElementById('account-type').addEventListener('change', function() {
            const accountType = this.value;
            const accountNameDropdown = document.getElementById('account-name');
            
            // إعادة تعيين الخيارات
            accountNameDropdown.innerHTML = '<option value="">يرجى اختيار الحساب</option>';
            
            if (accountType) {
                accountNameDropdown.disabled = false;
                
                // إضافة خيارات حسب نوع الحساب
                if (accountType === 'bank') {
                    // بيانات البنوك
                    const banks = [
                        { id: 'bank1', name: 'البنك الأهلي' },
                        { id: 'bank2', name: 'مصرف الراجحي' },
                        { id: 'bank3', name: 'بنك الرياض' }
                    ];
                    
                    banks.forEach(bank => {
                        const option = document.createElement('option');
                        option.value = bank.id;
                        option.textContent = bank.name;
                        accountNameDropdown.appendChild(option);
                    });
                } else if (accountType === 'cashbox') {
                    // بيانات الصناديق
                    const cashboxes = [
                        { id: 'cash1', name: 'الصندوق الرئيسي' },
                        { id: 'cash2', name: 'صندوق الفرع الأول' },
                        { id: 'cash3', name: 'صندوق الفرع الثاني' }
                    ];
                    
                    cashboxes.forEach(cashbox => {
                        const option = document.createElement('option');
                        option.value = cashbox.id;
                        option.textContent = cashbox.name;
                        accountNameDropdown.appendChild(option);
                    });
                }
                
                // تحديث البيان بعد تغيير نوع الحساب
                setTimeout(updateVoucherStatement, 100);
            } else {
                accountNameDropdown.disabled = true;
            }
        });
        
        // تعامل مع تغيير نوع الحساب الآخر
        document.getElementById('other-account-type').addEventListener('change', function() {
            const accountType = this.value;
            const accountNameDropdown = document.getElementById('other-account-name');
            
            // إعادة تعيين الخيارات
            accountNameDropdown.innerHTML = '<option value="">يرجى اختيار الحساب</option>';
            
            if (accountType) {
                accountNameDropdown.disabled = false;
                
                // إضافة خيارات حسب نوع الحساب
                switch(accountType) {
                    case 'supplier':
                        const suppliers = [
                            { id: 'sup1', name: 'شركة التوريدات العالمية' },
                            { id: 'sup2', name: 'مؤسسة الإمداد التجارية' },
                            { id: 'sup3', name: 'مكتب الخدمات المتكاملة' }
                        ];
                        
                        suppliers.forEach(supplier => {
                            const option = document.createElement('option');
                            option.value = supplier.id;
                            option.textContent = supplier.name;
                            accountNameDropdown.appendChild(option);
                        });
                        break;
                    
                    case 'employee':
                        const employees = [
                            { id: 'emp1', name: 'محمد أحمد' },
                            { id: 'emp2', name: 'عبدالله محمد' },
                            { id: 'emp3', name: 'خالد عبدالرحمن' }
                        ];
                        
                        employees.forEach(employee => {
                            const option = document.createElement('option');
                            option.value = employee.id;
                            option.textContent = employee.name;
                            accountNameDropdown.appendChild(option);
                        });
                        break;
                    
                    case 'customer':
                        const customers = [
                            { id: 'cust1', name: 'شركة السفر العالمية' },
                            { id: 'cust2', name: 'مؤسسة الرحلات المميزة' },
                            { id: 'cust3', name: 'أحمد محمد علي' }
                        ];
                        
                        customers.forEach(customer => {
                            const option = document.createElement('option');
                            option.value = customer.id;
                            option.textContent = customer.name;
                            accountNameDropdown.appendChild(option);
                        });
                        break;
                    
                    case 'bank':
                        const banks = [
                            { id: 'bank1', name: 'البنك الأهلي' },
                            { id: 'bank2', name: 'مصرف الراجحي' },
                            { id: 'bank3', name: 'بنك الرياض' }
                        ];
                        
                        banks.forEach(bank => {
                            const option = document.createElement('option');
                            option.value = bank.id;
                            option.textContent = bank.name;
                            accountNameDropdown.appendChild(option);
                        });
                        break;
                    
                    case 'cashbox':
                        const cashboxes = [
                            { id: 'cash1', name: 'الصندوق الرئيسي' },
                            { id: 'cash2', name: 'صندوق الفرع الأول' },
                            { id: 'cash3', name: 'صندوق الفرع الثاني' }
                        ];
                        
                        cashboxes.forEach(cashbox => {
                            const option = document.createElement('option');
                            option.value = cashbox.id;
                            option.textContent = cashbox.name;
                            accountNameDropdown.appendChild(option);
                        });
                        break;
                }
                
                // تحديث البيان بعد تغيير نوع الحساب
                setTimeout(updateVoucherStatement, 100);
            } else {
                accountNameDropdown.disabled = true;
            }
        });
        
        // تحديث رمز العملة وتحديث المبلغ بالحروف
        document.getElementById('currency-type').addEventListener('change', function() {
            const currencyType = this.value;
            const currencySymbol = document.getElementById('currency-symbol');
            
            switch(currencyType) {
                case 'SAR':
                    currencySymbol.textContent = 'ر.س';
                    break;
                case 'USD':
                    currencySymbol.textContent = '$';
                    break;
                case 'EUR':
                    currencySymbol.textContent = '€';
                    break;
                case 'GBP':
                    currencySymbol.textContent = '£';
                    break;
                case 'AED':
                    currencySymbol.textContent = 'د.إ';
                    break;
                default:
                    currencySymbol.textContent = 'ر.س';
            }
            
            // تحديث المبلغ بالحروف
            updateAmountInWords();
        });
        
        // تحديث المبلغ بالحروف عند تغيير قيمة المبلغ
        document.getElementById('amount').addEventListener('input', function() {
            updateAmountInWords();
        });
        
        document.getElementById('payment-voucher-form').addEventListener('submit', function(e) {
            e.preventDefault();
            // إزالة صفة القراءة فقط من وصف العملية لإرسال البيانات
            document.getElementById('description').readOnly = false;
            
            // هنا سيتم إرسال البيانات للخادم (سيتم تنفيذه لاحقاً)
            alert('تم حفظ سند الصرف بنجاح!');
            $('#modal-add-payment-voucher').modal('hide');
            
            // إعادة تعيين صفة القراءة فقط
            document.getElementById('description').readOnly = true;
        });
    });
    
    // وظيفة للحصول على النص العربي لنوع الحساب
    function getAccountTypeText(accountType) {
        switch(accountType) {
            case 'bank':
                return 'بنك';
            case 'cashbox':
                return 'صندوق';
            case 'supplier':
                return 'مورد';
            case 'employee':
                return 'موظف';
            case 'customer':
                return 'عميل';
            default:
                return accountType || '';
        }
    }
    
    // وظيفة لتحويل المبلغ إلى كلمات عربية
    function convertNumberToArabicWords(number, currency = 'SAR') {
        if (!number || isNaN(number)) {
            return '';
        }
        
        // تقريب الرقم إلى رقمين عشريين
        number = parseFloat(parseFloat(number).toFixed(2));
        
        // كتابة الأرقام بالحروف (مبسطة)
        const ones = ['', 'واحد', 'اثنان', 'ثلاثة', 'أربعة', 'خمسة', 'ستة', 'سبعة', 'ثمانية', 'تسعة', 'عشرة'];
        const teens = ['عشر', 'أحد عشر', 'اثنا عشر', 'ثلاثة عشر', 'أربعة عشر', 'خمسة عشر', 'ستة عشر', 'سبعة عشر', 'ثمانية عشر', 'تسعة عشر'];
        const tens = ['', 'عشرة', 'عشرون', 'ثلاثون', 'أربعون', 'خمسون', 'ستون', 'سبعون', 'ثمانون', 'تسعون'];
        const hundreds = ['', 'مائة', 'مائتان', 'ثلاثمائة', 'أربعمائة', 'خمسمائة', 'ستمائة', 'سبعمائة', 'ثمانمائة', 'تسعمائة'];
        const thousands = ['', 'ألف', 'ألفان', 'آلاف', 'آلاف', 'آلاف', 'آلاف', 'آلاف', 'آلاف', 'آلاف', 'آلاف'];
        
        // أسماء العملات
        const currencyNames = {
            'SAR': 'ريال سعودي',
            'USD': 'دولار أمريكي',
            'EUR': 'يورو',
            'GBP': 'جنيه إسترليني',
            'AED': 'درهم إماراتي'
        };
        
        // اسم العملة باللغة العربية كما هو معروض في واجهة المستخدم (بدون الرمز)
        const currencyDisplayNames = {
            'SAR': function() {
                const optionText = document.querySelector('#currency-type option[value="SAR"]')?.textContent.trim() || 'ريال سعودي (SAR)';
                return optionText.replace(/\s*\([^)]*\)\s*$/, ''); // إزالة النص بين قوسين في النهاية
            },
            'USD': function() {
                const optionText = document.querySelector('#currency-type option[value="USD"]')?.textContent.trim() || 'دولار أمريكي (USD)';
                return optionText.replace(/\s*\([^)]*\)\s*$/, '');
            },
            'EUR': function() {
                const optionText = document.querySelector('#currency-type option[value="EUR"]')?.textContent.trim() || 'يورو (EUR)';
                return optionText.replace(/\s*\([^)]*\)\s*$/, '');
            },
            'GBP': function() {
                const optionText = document.querySelector('#currency-type option[value="GBP"]')?.textContent.trim() || 'جنيه إسترليني (GBP)';
                return optionText.replace(/\s*\([^)]*\)\s*$/, '');
            },
            'AED': function() {
                const optionText = document.querySelector('#currency-type option[value="AED"]')?.textContent.trim() || 'درهم إماراتي (AED)';
                return optionText.replace(/\s*\([^)]*\)\s*$/, '');
            }
        };
        
        // تنفيذ مبسط - لأغراض العرض فقط
        // يجب تنفيذ خوارزمية أكثر تعقيدًا للاستخدام الحقيقي
        const integerPart = Math.floor(number);
        const decimalPart = Math.round((number - integerPart) * 100);
        
        let result = '';
        
        if (integerPart === 0) {
            result = 'صفر';
        } else if (integerPart < 11) {
            result = ones[integerPart];
        } else if (integerPart < 20) {
            result = teens[integerPart - 10];
        } else if (integerPart < 100) {
            const oneDigit = integerPart % 10;
            const tenDigit = Math.floor(integerPart / 10);
            
            if (oneDigit === 0) {
                result = tens[tenDigit];
            } else {
                result = ones[oneDigit] + ' و' + tens[tenDigit];
            }
        } else if (integerPart < 1000) {
            const hundredDigit = Math.floor(integerPart / 100);
            const remainder = integerPart % 100;
            
            result = hundreds[hundredDigit];
            
            if (remainder > 0) {
                if (remainder < 11) {
                    result += ' و' + ones[remainder];
                } else if (remainder < 20) {
                    result += ' و' + teens[remainder - 10];
                } else {
                    const oneDigit = remainder % 10;
                    const tenDigit = Math.floor(remainder / 10);
                    
                    if (oneDigit === 0) {
                        result += ' و' + tens[tenDigit];
                    } else {
                        result += ' و' + ones[oneDigit] + ' و' + tens[tenDigit];
                    }
                }
            }
        } else if (integerPart < 10000) {
            const thousandDigit = Math.floor(integerPart / 1000);
            const remainder = integerPart % 1000;
            
            if (thousandDigit === 1) {
                result = thousands[1];
            } else if (thousandDigit === 2) {
                result = thousands[2];
            } else {
                result = ones[thousandDigit] + ' ' + thousands[3];
            }
            
            if (remainder > 0) {
                // إضافة باقي الأرقام بشكل مماثل (مبسط هنا)
                result += ' و' + convertNumberToArabicWords(remainder, '');
            }
        } else {
            // للأرقام الأكبر من 10000 - مبسط
            result = integerPart.toLocaleString('ar-SA');
        }
        
        // إضافة اسم العملة
        if (currency) {
            // استخدام اسم العملة من واجهة المستخدم بدلاً من القيمة المحددة مسبقاً
            const currencyDisplayName = currencyDisplayNames[currency] ? currencyDisplayNames[currency]() : currencyNames[currency] || currencyNames['SAR'];
            result += ' ' + currencyDisplayName;
            
            // إضافة الهللات أو السنتات إذا وجدت
            if (decimalPart > 0) {
                let decimalWord = '';
                
                if (decimalPart < 11) {
                    decimalWord = ones[decimalPart];
                } else if (decimalPart < 20) {
                    decimalWord = teens[decimalPart - 10];
                } else {
                    const oneDigit = decimalPart % 10;
                    const tenDigit = Math.floor(decimalPart / 10);
                    
                    if (oneDigit === 0) {
                        decimalWord = tens[tenDigit];
                    } else {
                        decimalWord = ones[oneDigit] + ' و' + tens[tenDigit];
                    }
                }
                
                let subUnit = '';
                switch(currency) {
                    case 'SAR':
                        subUnit = 'هللة';
                        break;
                    case 'USD':
                    case 'GBP':
                        subUnit = 'سنت';
                        break;
                    case 'EUR':
                        subUnit = 'سنت يورو';
                        break;
                    case 'AED':
                        subUnit = 'فلس';
                        break;
                    default:
                        subUnit = 'جزء';
                }
                
                result += ' و' + decimalWord + ' ' + subUnit;
            }
        }
        
        return currency ? ('فقط ' + result + ' لا غير') : result;
    }
    
    // وظيفة لتحديث المبلغ بالحروف
    function updateAmountInWords() {
        const amountInput = document.getElementById('amount');
        const currencySelect = document.getElementById('currency-type');
        const amountInWordsElem = document.getElementById('amount-in-words');
        
        if (!amountInput || !currencySelect || !amountInWordsElem) {
            return;
        }
        
        const amount = parseFloat(amountInput.value);
        const currency = currencySelect.value;
        
        if (!isNaN(amount) && amount > 0) {
            const amountInWords = convertNumberToArabicWords(amount, currency);
            amountInWordsElem.textContent = 'المبلغ بالحروف: ' + amountInWords;
        } else {
            amountInWordsElem.textContent = 'المبلغ بالحروف: ';
        }
    }
    
    // وظيفة لتحديث البيان تلقائياً
    function updateVoucherStatement() {
        // الحصول على القيم من الحقول
        const accountTypeSelect = document.getElementById('account-type');
        const accountNameSelect = document.getElementById('account-name');
        const otherAccountTypeSelect = document.getElementById('other-account-type');
        const otherAccountNameSelect = document.getElementById('other-account-name');
        const referenceTypeInput = document.getElementById('reference-type');
        const referenceNumberInput = document.getElementById('reference-number');
        const descriptionTextarea = document.getElementById('description');
        
        // التحقق من وجود القيم المطلوبة
        if (!accountTypeSelect || !accountNameSelect || !otherAccountTypeSelect || 
            !otherAccountNameSelect || !descriptionTextarea) {
            return;
        }
        
        // القيم المحددة
        const accountType = accountTypeSelect.value;
        const accountName = accountNameSelect.options[accountNameSelect.selectedIndex]?.text || '';
        const otherAccountType = otherAccountTypeSelect.value;
        const otherAccountName = otherAccountNameSelect.options[otherAccountNameSelect.selectedIndex]?.text || '';
        const referenceType = referenceTypeInput.value.trim();
        const referenceNumber = referenceNumberInput.value.trim();
        
        // ترجمة أنواع الحسابات إلى العربية
        const accountTypeText = getAccountTypeText(accountType);
        const otherAccountTypeText = getAccountTypeText(otherAccountType);
        
        // توليد البيان بناءً على البيانات المدخلة
        let statement = '';
        
        if (accountType && accountName && otherAccountType && otherAccountName) {
            if (accountType === 'bank') {
                statement = `سند صرف حوالة من ${accountTypeText} ${accountName} إلى ${otherAccountTypeText} ${otherAccountName}`;
            } else {
                statement = `سند صرف من ${accountTypeText} ${accountName} إلى ${otherAccountTypeText} ${otherAccountName}`;
            }
            
            // إضافة المرجع إذا كان موجوداً
            if (referenceType && referenceNumber) {
                statement += ` عبر ${referenceType} برقم ${referenceNumber}`;
            } else if (referenceType) {
                statement += ` عبر ${referenceType}`;
            }
        }
        
        // تحديث حقل البيان
        descriptionTextarea.value = statement;
        
        // إلغاء صفة القراءة فقط مؤقتاً للسماح بالتعديل
        descriptionTextarea.readOnly = false;
        // إعادة تعيين صفة القراءة فقط بعد لحظة
        setTimeout(() => {
            descriptionTextarea.readOnly = true;
        }, 100);
    }
</script>
{% endblock %}